myApp = angular.module('myApp', ['ngRoute', 'ngMessages', 'ngAnimate', 'ui.bootstrap', 'toaster', 'ngStorage', 'ngSanitize', 'angular-spinkit']);

/*myApp.run(function($location, $rootScope, $http){
});*/


myApp.config(function($routeProvider){
	$routeProvider.
	when('/', {templateUrl: 'partials/carousel.html?111222_1', controller: "carouselCtrl"}).
	when('/contact-details', {templateUrl: 'partials/contact.html', controller: "contactCtrl"}).
	when('/guidelines', {templateUrl: 'partials/guidelines.html', controller: "guidelinesCtrl"}).
	when('/applicant/document/clearance_documents', {templateUrl: 'partials/clearance_documents.html', controller: "clearanceCtrl1"}).
	when('/change-password', {templateUrl: 'partials/change-password.html', controller: "changePasswordCtrl"}).
	when('/applicant/applicant-dashboard', {templateUrl: 'partials/student-dashboard.html?071222_8', controller: "applicantDashCtrl"}).
	when('/applicant/payment-success/:orderId', {templateUrl: 'partials/payment-success.html?010921', controller: "paymentSuccessCtrl"}).
	when('/applicant/payment-error/:errorCde', {templateUrl: 'partials/payment-error.html?010921', controller: "paymentErrorCtrl"}).
	when('/applicant/applicant-bio-data/', {templateUrl: 'partials/n-biodata-utme.html?1110', controller: "biodataUTMECtrl"}). 
	/*when('/applicant/changeofcourse/', {templateUrl: 'partials/changeofcourse.html', controller: "changeofcourseCtrl"}).*/
	when('/medicalreport/', {templateUrl: 'partials/medical.html', controller: "medicalCtrl"}).
	when('/printmedicalreport/', {templateUrl: 'partials/printmedical.html', controller: "printMedicalCtrl"}).
	when('/acceptanceletter/', {templateUrl: 'partials/acceptance_form.html', controller: "acceptanceCtrl"}).
	when('/applicant/sample-questions', {templateUrl: 'partials/sample-questions.html', controller: "sampQuestionsCtrl"}).
	
	when('/applicant/invitation-letter', {templateUrl: 'partials/invitationletter1.html?100', controller: "invitationCtrl"}).
	
		when('/applicant/putme-result', {templateUrl: 'partials/result.html?11111', controller: "invitationCtrl"}).
	// additional information for direct entry candidates
	when('/applicant/applicant-bio-data-de/', {templateUrl: 'partials/n-biodata-de.html?1110', controller: "biodataDECtrl1"}). 
	// end of additional information for direct entry candidates
	
	when('/applicant/applicant-clearance/', {templateUrl: 'partials/n-clearance.html?020921', controller: "clearanceCtrl"}).
	when('/applicant/document/clearance-evidence/:jambNo', {templateUrl: 'partials/clearance_evidence.html?060921_2', controller: "clearanceEvidenceCtrl"}).
	when('/admin/clearance/:type', {templateUrl: 'partials/clearance-process.html', controller: "clearanceProcessCtrl"}).
	
	when('/applicant/document/authority-to-pay/', {templateUrl: 'partials/authority_to_pay.html', controller: "authorityToPayCtrl"}).
	
	

	when('/applicant/document/registration-evidence/:jambNo', {templateUrl: 'partials/registration_evidence.html?1110', controller: "registrationEvidenceCtrl"}). 
	when('/admin/admin-dashboard', {templateUrl: 'partials/admin-dashboard.html', controller: "adminDashCtrl"}).
	when('/admin/students/:type', {templateUrl: 'partials/admin-applicants.html', controller: "adminApplicantCtrl"}).
	when('/admin/search-students/', {templateUrl: 'partials/admin-search-applicants.html', controller: "adminSearchApplicantCtrl"}).
	when('/admin/students/applicant-page/:jambNo', {templateUrl: 'partials/admin-applicant-data.html', controller: "adminApplicantDataCtrl"}).
	when('/admin/students/applicant-bio-data/:jambNo', {templateUrl: 'partials/biodata.html', controller: "biodataCtrl"}).
	when('/admin/account-management', {templateUrl: 'partials/account-management.html', controller: "AccountManagementCtrl"}).
	when('/admin/transactions', {templateUrl: 'partials/post-utme-management.html', controller: "PostUTMEManagementCtrl"}).
	when('/instruction', {templateUrl: 'partials/instruction.html', controller: "instructionCtrl"}).
	when('/contact', {templateUrl: 'partials/contact.html', controller: "contactCtrl"}).
	when('/administration', {templateUrl: 'partials/administration.html', controller: "settingCtrl"}).
	// when('/applicant/reprint-payment-receipt/', {templateUrl: 'partials/payment-success-reprint.html?010921', controller: "reprintReceiptCtrl1"}).	
	// when('/applicant/reprint-screening-payment-receipt/', {templateUrl: 'partials/payment-screening-success-reprint.html?010921', controller: "reprintScreeningReceiptCtrl1"}).
	when('/applicant/reprint-payment-receipt/:feeType', {templateUrl: 'partials/payment-success-reprint.html?010921', controller: "reprintReceiptCtrl1"}).
	
	otherwise({redirectTo: '/error-page', templateUrl: 'partials/error-page.html'})
	
	
	})
	.run(function($location, $rootScope, Data, $localStorage){
        $rootScope.$on("$routeChangeStart", function (event, next, current) {
			var nextUrl = next.$$route.originalPath;
			$rootScope.menu_contents = Array();
			
			if(nextUrl == '/signup' || nextUrl == '/login'){
				$location.path("/");
			}
			else if(nextUrl == '/' || nextUrl == '/contact-details' || nextUrl == '/guidelines'){
				//alert('here');
				//$location.path("/");
				if(nextUrl == '/'){
					$rootScope.isMain = true;
				}
				else{
					$rootScope.isMain = false;
				}
				
				if($rootScope.authenticated || $rootScope.non_authenticated_pages || $localStorage.user_details){
					$rootScope.authenticated = true;
					user_details = $localStorage.user_details;
					
					if(user_details.sq_id_fk == 0){
						$location.path("change-password/");
					}
					else{
						if(user_details.userType == "applicant"){
							$location.path("applicant/applicant-dashboard/");
						}
						else if(user_details.userType == "admin" ||user_details.userType == "superadmin"){
							$location.path("admin/admin-dashboard/");
						}
						else{
							//$location.path("applicant/error-page/");
						}
					}
				}
				
				$rootScope.menu_contents = getMenuContent("general");
				$rootScope.menu_contents = setActiveMenu($rootScope.menu_contents, nextUrl);
			}
			else{
				if(nextUrl.indexOf('admin/') !== -1 && (user_details.userType == "admin" || user_details.userType == "superadmin")){
					$rootScope.menu_contents = getMenuContent("admin", $localStorage.user_details.userType);
					$rootScope.menu_contents = setActiveMenu($rootScope.menu_contents, nextUrl);
				}
				else{
					//$rootScope.menu_contents = getMenuContent("applicant");
					$rootScope.menu_contents = setActiveMenu($rootScope.menu_contents, nextUrl);
				}
				
				if($rootScope.authenticated || $rootScope.non_authenticated_pages){
					user_details = $localStorage.user_details;
					bio_data = $localStorage.bio_data;
					
					$rootScope.authenticated = true;
					$rootScope.isMain = false;
					
					if(user_details.userType == "applicant"){
						//alert('setting Bio-Data Page');
						var jambRegNo = user_details.username;
						var applicantMode = bio_data.applicantMode;
						var jambScore = bio_data.jambScore;
						var paymentStatus = bio_data.paymentStatus;
						
						/*if(jambScore < 200){
							eligibility = false;
							paid = false;
						}
						else{*/
							eligibility = true;
							/*if(paymentStatus == "NULL" || paymentStatus == "unpaid" || paymentStatus === null){*/
							if(bio_data.portal_payment_status == "unpaid" || bio_data.screening_payment_status == "unpaid"){
								paid = false;
							}
							else{
								paid = true;
							}
						//}
						
						//$rootScope.menu_contents = updateApplicantBiodataUrl($rootScope.menu_contents, jambRegNo);
						$rootScope.menu_contents = getApplicantMenuContent(applicantMode, jambRegNo, eligibility, paid);
						$rootScope.menu_contents = setActiveMenu($rootScope.menu_contents, nextUrl);
						//alert(JSON.stringify($rootScope.menu_contents));
					}
					
					if(user_details.userType == "applicant" && nextUrl.indexOf('admin/') !== -1){
						$location.path("applicant/applicant-dashboard/");
					}
					if(user_details.userType == "admin" && nextUrl.indexOf('applicant/') !== -1){
						$location.path("admin/admin-dashboard/");
					}
				}
				else if($localStorage.user_details){
					user_details = $localStorage.user_details;
					bio_data = $localStorage.bio_data;
					//alert(nextUrl);
					$rootScope.authenticated = true;
					$rootScope.isMain = false;
					
					if(user_details.userType == "applicant"){
						//alert('setting Bio-Data Page');
						var jambRegNo = user_details.username;
						var applicantMode = bio_data.applicantMode;
						var jambScore = bio_data.jambScore;
						var paymentStatus = bio_data.paymentStatus;
						
						/*if(jambScore < 200){
							var eligibility = false;
							var paid = false;
						}
						else{*/
							var eligibility = true;
							if(bio_data.portal_payment_status == "unpaid" || bio_data.screening_payment_status == "unpaid"){
								var paid = false;
							}
							else{
								var paid = true;
							}
						//}
						
						//$rootScope.menu_contents = updateApplicantBiodataUrl($rootScope.menu_contents, jambRegNo);
						
						$rootScope.menu_contents = getApplicantMenuContent(applicantMode, jambRegNo, eligibility, paid);
						$rootScope.menu_contents = setActiveMenu($rootScope.menu_contents, nextUrl);
					}
					
					if(user_details.userType == "applicant" && nextUrl.indexOf('admin/') !== -1){
						$location.path("applicant/applicant-dashboard/");
					}
					if(user_details.userType == "admin" && nextUrl.indexOf('applicant/') !== -1){
						$location.path("admin/admin-dashboard/");
					}
				}
				else{
					$location.path("/");
				}
			};
        });
    	
		
    });

function getMenuContent(menu_type, user_type){
    //alert(menu_type);
    
	if(menu_type == "admin"){
	    if(user_type == "admission"){
						menu_contents = [
							{
								name: 'Home',
								url: '#/admin/admin-dashboard',
								short: 'dashboard',
								classes: '',
								logo: 'icon-home',
								isBigger: true,
								isHome: true,
								isActive: false,
								visibilityLevel: 0,
								hasSubMenu: false,
								subMenus: []
							},
							{
								name: 'Clearance',
								url: '#/admin/clearance',
								short: 'clearance',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Pending Applicants',
											  url:'admin/clearance/pending'  
											},
											{
											  name:'Cleared Applicants',
											  url:'admin/clearance/cleared'  
											},
											{
											  name:'Clear Applicants',
											  url:'admin/clearance/upload'  
											}
										]
							},
							{
								name: 'Account Management',
								url: '#/admin/account-management',
								short: 'account',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}
						];

		}
		else{
    		menu_contents = [
    						{
    							name: 'Home',
    							url: '#/admin/admin-dashboard',
    							short: 'dashboard',
    							classes: '',
    							logo: 'icon-home',
    							isBigger: true,
    							isHome: true,
    							isActive: false,
    							visibilityLevel: 0,
    							hasSubMenu: false,
    							subMenus: []
    						},
    						{
    							name: 'Students',
    							url: '#/admin/students',
    							short: 'student',
    							classes: '',
    							logo: '',
    							isBigger: false,
    							isHome: false,
    							isActive: false,
    							hasSubMenu: true,
    							subMenus: [
    										{
    										  name:'UTME Students',
    										  url:'admin/students/utme'  
    										},
    										{
    										  name:'DE Students',
    										  url:'admin/students/de'  
    										},
    										{
    										  name:'Search Students',
    										  url:'admin/search-students/'  
    										}
    									]
    						},
    						/*{
    							name: 'Post-UTME Settings',
    							url: '#/admin/settings',
    							short: 'setting',
    							classes: '',
    							logo: '',
    							isBigger: false,
    							isHome: false,
    							isActive: false,
    							hasSubMenu: false,
    							subMenus: []
    						},*/
    						{
    							name: 'Account Management',
    							url: '#/admin/account-management',
    							short: 'account',
    							classes: '',
    							logo: '',
    							isBigger: false,
    							isHome: false,
    							isActive: false,
    							hasSubMenu: false,
    							subMenus: []
    						},
    						{
    							name: 'Post-UTME',
    							url: '#/admin/transactions',
    							short: 'post-utme',
    							classes: '',
    							logo: '',
    							isBigger: false,
    							isHome: false,
    							isActive: false,
    							hasSubMenu: false,
    							subMenus: []
    						}
    					];
		}
	}
	else if(menu_type == "applicant"){
		menu_contents = [
						{
							name: 'Home',
							url: '#/applicant/applicant-dashboard',
							short: 'dashboard',
							classes: '',
							logo: 'icon-home',
							isBigger: true,
							isHome: true,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},
						/*
						{
							name: 'Bio-Data',
							url: '#/applicant/applicant-bio-data/',
							short: 'bio-data',
							classes: '',
							logo: '',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},
						
						{
							name: 'Sample Questions',
							url: '#/applicant/sample-questions',
							short: 'questions',
							classes: '',
							logo: '',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},*/
						{
							name: 'Post-UTME Documents',
							url: '#/applicant/document',
							short: 'document',
							classes: '',
							logo: '',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: true,
							subMenus: [
										{
										  name:'Exam Invitation Letter',
										  url:'applicant/document/post-utme-invitation-letter'  
										},
										{
										  name:'Post-UTME Result',
										  url:'applicant/document/post-utme-result'  
										},
										{
										  name:'Cutoff Marks',
										  url:'applicant/document/post-utme-cutoff'  
										},
										{
										  name:'Provisional Admission',
										  url:'#/applicant/print/provisional-admission'  
										}
									]
						}
					];
	}
	else{
		menu_contents = [
						{
							name: 'Home',
							url: '#/',
							short: 'home',
							classes: '',
							logo: 'icon-home',
							isBigger: true,
							isHome: true,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},
						{
							name: 'Guidelines',
							url: '#/guidelines',
							short: 'guide',
							classes: '',
							logo: 'icon-file',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},
						/*{
							name: 'Admissions Unit',
							url: '#/faq',
							short: 'faq',
							classes: '',
							logo: '',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},
						{
							name: 'FAQs',
							url: '#/faq',
							short: 'faq',
							classes: '',
							logo: 'icon-question-sign',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						},*/
						{
							name: 'Contact Us',
							url: '#/contact-details',
							short: 'contact',
							classes: '',
							logo: 'icon-envelope',
							isBigger: false,
							isHome: false,
							isActive: false,
							hasSubMenu: false,
							subMenus: []
						}
					];
	}
	//alert(JSON.stringify(menu_contents));
	return menu_contents;
}

function getApplicantMenuContent(applicantMode, jambRegNo, eligibility, paid){
	//alert(eligibility);
	if(eligibility && paid){
		if(applicantMode === "utme" || applicantMode === "UTME"){
			menu_contents = [
							{
								name: 'Home',
								url: '#/applicant/applicant-dashboard',
								short: 'dashboard',
								classes: '',
								logo: 'icon-home',
								isBigger: true,
								isHome: true,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},
							/*{
								name: 'Reprint Receipt',
								url: '#/applicant/reprint-screening-payment-receipt',
								short: 'receipt',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}, 
							{
								name: 'Sample Questions',
								url: '#/applicant/sample-questions',
								short: 'questions',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},*/
							{
								name: 'Bio-Data',
								url: '#/applicant/applicant-bio-data/',
								short: 'bio-data',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}
							/*,
							
							{
								name: 'Change of Course',
								url: '#/applicant/changeofcourse',
								short: 'changeofcourse',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}
							,
							{
								name: 'Screening Documents',
								url: '#/applicant/document',
								short: 'print',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Print Payment Receipt',
											  url:'applicant/reprint-payment-receipt/'  
											}
										]
							},
							
							{
								name: 'Post-UTME',
								url: '#/applicant/document',
								short: 'document',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Exam Invitation Letter',
											  url:'applicant/document/post-utme-invitation-letter/'+jambRegNo  
											},
											{
											  name:'Post-UTME Result',
											  url:'applicant/document/post-utme-result/'+jambRegNo
											},
											{
											  name:'Cutoff Marks',
											  url:'applicant/document/post-utme-cutoff'
											},
											{
											  name:'Provisional Admission',
											  url:'#/applicant/print/provisional-admission/'+jambRegNo
											}
										]
							}*/
						];
		}else if(applicantMode === "de" || applicantMode === "DE"){
			menu_contents = [
							{
								name: 'Home',
								url: '#/applicant/applicant-dashboard',
								short: 'dashboard',
								classes: '',
								logo: 'icon-home',
								isBigger: true,
								isHome: true,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},
							{
								name: 'Bio-Data',
								url: '#/applicant/applicant-bio-data-de/',
								short: 'bio-data',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}
							/*,
							{
								name: 'Reprint Receipt',
								url: '#/applicant/reprint-screening-payment-receipt',
								short: 'receipt',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}*/
							/*{
								name: 'Screening Documents',
								url: '#/applicant/document',
								short: 'print',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Print Payment Receipt',
											  url:'applicant/reprint-payment-receipt/'  
											}
										]
							}
							,
							{
								name: 'Sample Questions',
								url: '#/applicant/sample-questions',
								short: 'questions',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},
							{
								name: 'Post-UTME',
								url: '#/applicant/document',
								short: 'document',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Exam Invitation Letter',
											  url:'applicant/document/post-utme-invitation-letter/'+jambRegNo  
											},
											{
											  name:'Post-UTME Result',
											  url:'applicant/document/post-utme-result/'+jambRegNo
											},
											{
											  name:'Cutoff Marks',
											  url:'applicant/document/post-utme-cutoff'
											},
											{
											  name:'Provisional Admission',
											  url:'#/applicant/print/provisional-admission/'+jambRegNo
											}
										]
							}*/
						];
		}
		else{
			menu_contents = [
							{
								name: 'Home',
								url: '#/applicant/applicant-dashboard',
								short: 'dashboard',
								classes: '',
								logo: 'icon-home',
								isBigger: true,
								isHome: true,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},
							/*{
								name: 'Bio-Data',
								url: '#/applicant/applicant-de-bio-data/'+jambRegNo,
								short: 'bio-data',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}*/
							
							/*,
							{
								name: 'Sample Questions',
								url: '#/applicant/sample-questions',
								short: 'questions',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							},
							{
								name: 'Post-UTME',
								url: '#/applicant/document',
								short: 'document',
								classes: '',
								logo: '',
								isBigger: false,
								isHome: false,
								isActive: false,
								hasSubMenu: true,
								subMenus: [
											{
											  name:'Exam Invitation Letter',
											  url:'applicant/document/post-utme-invitation-letter/'+jambRegNo  
											},
											{
											  name:'Post-UTME Result',
											  url:'applicant/document/post-utme-result/'+jambRegNo
											},
											{
											  name:'Cutoff Marks',
											  url:'applicant/document/post-utme-cutoff'
											},
											{
											  name:'Provisional Admission',
											  url:'#/applicant/print/provisional-admission/'+jambRegNo
											}
										]
							}*/
						];
		}
	}
	else{
		menu_contents = [
							{
								name: 'Home',
								url: '#/applicant/applicant-dashboard',
								short: 'dashboard',
								classes: '',
								logo: 'icon-home',
								isBigger: true,
								isHome: true,
								isActive: false,
								hasSubMenu: false,
								subMenus: []
							}
						];
	}
	
	return menu_contents;
}

function setActiveMenu(menu_contents, url){
	for(var i = 0; i < menu_contents.length; i++) {		
		if(url.indexOf(menu_contents[i]['short']) !== -1){
			menu_contents[i]['isActive'] = true;
		}
		else if(menu_contents[i]['short'] == "home"  && url == "/"){
			menu_contents[i]['isActive'] = true;
		}
		else{
			menu_contents[i]['isActive'] = false;
		}
	}
	
	return menu_contents;
}

function updateApplicantBiodataUrl(menu_contents, jambRegNo){
	for(var i = 0; i < menu_contents.length; i++) {		
		/*if(menu_contents[i]['short'].indexOf('bio-data') !== -1){
			menu_contents[i]['url'] = '#/applicant/applicant-bio-data/'+jambRegNo;
			//break;
		}
		else */if(menu_contents[i]['short'].indexOf('post-utme-invitation-letter') !== -1){
			
		}
	}
	
	return menu_contents;
}

/*$location.path("documents/"+ $scope.data[0].applicantId + "/" + $scope.data[0].applicantSurname + "/" + $scope.data[0].applicantFirstname + "/" + $scope.data[0].lastname + "/" + $scope.data[0].homeTown + "/" + $scope.data[0].gender + "/" + $scope.data[0].maritalStatus + "/" + $scope.data[0].nationality + "/" + $scope.data[0].state + "/" + $scope.data[0].lga);	
*/