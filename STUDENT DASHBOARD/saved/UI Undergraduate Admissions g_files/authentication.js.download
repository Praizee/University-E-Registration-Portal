// carousal controller
myApp.controller("carouselCtrl", function($rootScope, $scope, $routeParams, $location, $http, Data, $localStorage){
	/*if($localStorage.user_details){
		$scope.user_details = $localStorage.user_details;
		alert($scope.user_details.username);
	}*/
	$rootScope.content_loaded = false;
	
	$scope.login_dv = true;
	$scope.forgot_password = false;
	$scope.reset_pass_dv = false;
	
	var serviceBase = 'backend/';
	if($rootScope.secret_questions){
		$scope.login = {};
		$scope.signup = {};
		$scope.forgot_password = false;
		
		$rootScope.content_loaded = true;
	}
	else{
		$http.get(serviceBase+"authentication.php?action=secret_questions")
		.success(function(data) {
			if(data.status === "success"){
				secret_questions = data.questions;
				//$rootScope.secret_questions = secret_questions;
				
				//alert(secret_questions[0]['sq_id']);
				
				$rootScope.secret_questions = Array();
				for(var i = 0; i < secret_questions.length; i++) {
					$rootScope.secret_questions[i] = {
									id: secret_questions[i]['sq_id'],
									question: secret_questions[i]['question']
									}
				}
				
				//alert(JSON.stringify($rootScope.questions));
				
				$scope.login = {};
				$scope.signup = {};
				$scope.forgot_password = false;
			}
			
			$rootScope.content_loaded = true;
		})
		.error(function(data) {
			$scope.hasError = "A network connection problem error occured while signing in. Please try again";
			
			$rootScope.content_loaded = true;
		});
	}
	
    $scope.activateLoginDv = function(){
		$scope.login_dv = true;
		$scope.forgot_password = false;
		$scope.reset_pass_dv = false;
	};
	
    $scope.activateResetPasswordDv = function(){
		//$rootScope.isMain = false;
		$scope.login_dv = false;
		$scope.forgot_password = true;
		$scope.reset_pass_dv = false;
	};
	
    $scope.doLogin = function (user) {
		$scope.user = user;
		
		//alert(JSON.stringify(user));
		$http.post(serviceBase+"authentication.php?action=login", $scope.user)
		.success(function(data) {
			Data.toast(data);
			if(data.status === "success"){
				user_details = data.user_details;
				bio_data = data.bio_data;
				samp_q_downloads = data.samp_q_downloads;
				additional_download_subjects = data.additional_subjects;
				
				//alert(additional_download_subjects);
				
				$rootScope.user_details = user_details;
				$localStorage.user_details = user_details;
				
				$rootScope.bio_data = bio_data;
				$localStorage.bio_data = bio_data;
				$localStorage.subjectCombinationStatus = data.subjectCombinationStatus;
				$localStorage.setting = data.setting;
				
				$rootScope.additional_download_subjects = additional_download_subjects;
				$localStorage.additional_download_subjects = additional_download_subjects;
				
				$scope.samp_q_downloads = Array();
				for(var i = 0; i < samp_q_downloads.length; i++) {
					$scope.samp_q_downloads[i] = {
									samp_qid: samp_q_downloads[i]['samp_qid'],
									no_of_downloads: samp_q_downloads[i]['no_of_downloads']
									}
				}
				$rootScope.samp_q_downloads = $scope.samp_q_downloads;
				$localStorage.samp_q_downloads = $scope.samp_q_downloads;
				
				//alert(JSON.stringify(bio_data));
				
				$rootScope.authenticated = true;
				if(user_details.sq_id_fk == 0){
					$location.path("change-password/");
				}
				else{
					if(user_details.userType == "applicant"){
						$location.path("applicant/applicant-dashboard/");
					}
					else if(user_details.userType == "superadmin"){
						$location.path("admin/admin-dashboard/");
					}
					else if(user_details.userType == "admin"){
						$location.path("admin/admin-dashboard/");
					}
					else{
						$location.path("applicant/error/");
					}
				}
			}
		})
		.error(function(data) {
			$scope.hasError = "A network connection problem error occured while signing in. Please try again";
		});
    };
	
    $scope.doReset = function(reset_data) {
		$scope.reset_data = reset_data;
		
		//alert(JSON.stringify(reset_data));
		
		$http.post(serviceBase+"authentication.php?action=reset_password", $scope.reset_data)
		.success(function(data) {
			if(data.status === "success"){
				//alert(data.message);
				$scope.reset_password_message = data.message;
				$scope.reset_message_p = true;
				
				$scope.forgot_password = false;
				$scope.login_dv = false;
				$scope.reset_pass_dv = true;
			}
			else{
				Data.toast(data);
			}
		})
		.error(function(data) {
			$scope.hasError = "A network connection problem error occured while signing in. Please try again";
		});/**/
    };
});

myApp.controller("changePasswordCtrl", function($rootScope, $scope, $routeParams, $location, $http, Data, $localStorage){
	$rootScope.page = "change_password"; 
	
	var serviceBase = 'backend/';
	
	if($rootScope.secret_questions){
		$scope.login = {};
	}
	else{
		$http.get(serviceBase+"authentication.php?action=secret_questions")
		.success(function(data) {
			if(data.status === "success"){
				secret_questions = data.questions;
				
				$rootScope.secret_questions = Array();
				for(var i = 0; i < secret_questions.length; i++) {
					$rootScope.secret_questions[i] = {
									id: secret_questions[i]['sq_id'],
									question: secret_questions[i]['question']
									}
				}
				
				$scope.login = {};
				$scope.signup = {};
				$scope.forgot_password = false;
			}
		})
		.error(function(data) {
			$scope.hasError = "A network connection problem error occured while signing in. Please try again";
		});
	}
	
	
    $scope.doChangePassword = function (change_data) {
		//Data.toast('yep');
		user_data = $localStorage.user_details;
		$scope.change = change_data;
		
		/*alert(JSON.stringify(user_data));*/
		//alert(JSON.stringify($scope.change.new_password));
		
		change_password_data = {
									user_data: user_data,
									password_data: $scope.change
								};
								
		//alert(JSON.stringify(change_password_data));
		
		if($scope.change.new_password.length < 6){
			message_code = {
							  status: 'error',
							  message: 'Password must be at least 6 characters or more'
						  };
			Data.toast(message_code);
		}
		else if($scope.change.new_password !== $scope.change.confirm_password){
			message_code = {
							  status: 'error',
							  message: 'Values entered for New Password and to Confirm Password do not match'
						  };
			Data.toast(message_code);
		}
		else{
			$http.post(serviceBase+"authentication.php?action=change_password", change_password_data )
			.success(function(data) {
				//alert(JSON.stringify(data));
				Data.toast(data);
				if(data.status === "success"){
					user_details = data.user_details;
					$rootScope.user_details = user_details;
					$localStorage.user_details = user_details;
					
					$rootScope.authenticated = true;
					if(user_details.sq_id_fk == 0){
						$location.path("change-password/");
					}
					else{
						if(user_details.userType == "applicant"){
							$location.path("applicant/applicant-dashboard/");
						}
						else{
							$location.path("admin/admin-dashboard/");
						}
					}
				}
			})
			.error(function(data) {
				$scope.hasError = "A network connection problem error occured while signing in. Please try again";
			});/**/
		}
    };
});

myApp.controller("contactCtrl", function($rootScope, $scope, $routeParams, $location, $http, Data, $localStorage, $modal){
	$scope.admissions = true;
	$scope.technical_support = false;
	
    $scope.openAdmissionsContactDv = function(){
		$scope.closeAllDivs();
		$scope.admissions = true;
	};
	
    $scope.openTechnicalSupportContactDv = function(){
		$scope.closeAllDivs();
		$scope.technical_support = true;
	};
	
	$scope.closeAllDivs = function(){
		$scope.admissions = false;
		$scope.technical_support = false;
	}
});

myApp.controller("guidelinesCtrl", function($rootScope, $scope, $routeParams, $location, $http, Data, $localStorage, $modal){
	$scope.login_info = true;
	$scope.biodata_info = false;
	$scope.sample_questions_info = false;
	
    $scope.openLoginInfoDv = function(){
		$scope.closeAllDivs();
		$scope.login_info = true;
	};
	
    $scope.openBioDataInfoDv = function(){
		$scope.closeAllDivs();
		$scope.biodata_info = true;
	};
	
    $scope.openSampleQuestionsInfoDv = function(){
		$scope.closeAllDivs();
		$scope.sample_questions_info = true;
	};
	
	$scope.closeAllDivs = function(){
		$scope.login_info = false;
		$scope.biodata_info = false;
		$scope.sample_questions_info = false;
	}
});
