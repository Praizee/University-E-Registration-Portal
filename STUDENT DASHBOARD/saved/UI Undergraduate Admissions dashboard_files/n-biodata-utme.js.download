myApp.controller("biodataUTMECtrl", function($scope, $timeout, $rootScope, $http, $location, $modal, $routeParams, Data, $localStorage)
{
    
	
    
	$rootScope.content_loaded = false;
	$scope.uploading_olevel = false;
	
	$scope.applicant = $localStorage.bio_data;
	$scope.jambRegNo = $scope.applicant.jambRegNo;
	$scope.olevel_computation = $scope.applicant.olevel_score;

	//$location.path("applicant/applicant-dashboard/");//tbr
// 	alert($scope.applicant.applicantMode);

	if($scope.applicant.portal_payment_status == "paid" && $scope.applicant.screening_payment_status == "paid"){
// 	if($scope.applicant.paymentStatus == "paid"){
		if($scope.applicant.applicantMode == "DE"){
			$location.path("applicant/applicant-bio-data-de/");
		}
	}
	else{
		$location.path("applicant/applicant-dashboard/");
	}
	
	//alert($scope.olevel_computation);
	
	$scope.applicant_name = $scope.applicant.surname+", "+$scope.applicant.firstname+" "+$scope.applicant.middlename;
	$scope.buttonParts = ["dummy",false,false,false,false,false,false,false, false,false, false];
	$scope.nationality = ["[ Select Nationality ]"];
	$scope.phoneNumbr = /\d{11}/
	
	/***************************************************************************************************
	Various meenu updating section	
	****************************************************************************************************/
	$scope.applicant1 = $scope.applicant;
	//alert($scope.applicant1.jambRegNo);
	
	
	
	/***************************************************************************************************
	nd of various meenu updating section	
	****************************************************************************************************/

	
	// this is the date of birth section///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	//date of birth section
	$scope.day1 = "[ Day ]";
	$scope.month = "[ Month ]";
	$scope.year1 = "[ Year ]";
	$scope.days = ["[ Day ]"];
	$scope.months = ["[ Month ]"];
	$scope.years1 = ["[ Year ]"];
	$scope.years2 = ["[ Year ]"];
	

	// initialization of years 
	for( i=1960; i<=2008; i++)
	{
		$scope.years1.push(i);
	}
	
	
	// initialization of years 
	for( i=1940; i<=2050; i++)
	{
		$scope.years2.push(i);
	}
	
	
	// initialization of months 
	for( i=1; i<=12; i++)
	{
		if(i<10)
		{
		$scope.months.push("0" + i );
		}else
		{
		$scope.months.push(i);
		
		}
	}
	
	
	// initialization of days 
	for( i=1; i<=31; i++)
	{
		if(i<10)
		{
		$scope.days.push("0" + i );
		}else
		{
		$scope.days.push(i);
		
		}
	}

	// this is the end of date of birth section////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//alert($scope.applicant.biodataCompletionLevel);
	
	$scope.openDV = function(pos){
		//alert(pos);
		//$rootScope.isMain = false;
		$scope.basic_info_dv = false;
		$scope.personal_dv = false;
		$scope.nok_dv = false;
		$scope.photo_sig_dv = false;
		$scope.olevel_dv = false;
		$scope.affiliate_dv = false;
		$scope.review_dv = false;
		$scope.complete_dv = false;
		
		if(pos == 1){
			$scope.basic_info_dv = true;
		}
		else if(pos == 2){
			$scope.personal_dv = true;
		}
		else if(pos == 3){
			$scope.nok_dv = true;
		} 
		else if(pos == 4){
			$scope.photo_sig_dv = true;
		}
		else if(pos == 5){
			$scope.olevel_dv = true;
		}
		else if(pos == 6){
			$scope.affiliate_dv = true;
		}
		else if(pos == 7){
			$scope.review_dv = true;
		}
		else if(pos == 8){
			$scope.complete_dv = true;
		}
	};
	
	$scope.openDV($scope.applicant.biodataCompletionLevel);
	
	// initialisation of some variables
	$scope.subjectAndGrade =[];
	$scope.olevelSubjects = [];
	$scope.uploadProfileImaage = false;
	$scope.doubleClickedP = false;
	$scope.doubleClickedS = false;
	$scope.subjectCounter = 0;
	$scope.olevelSelected = false;
	$scope.subject = "[ Select Subjects ]";
	$scope.grade = "[ Select Grades ]";
	$scope.singleOrMore = "subject";
	$scope.isSelected = false;
	$scope.uploadSignature = false;
	$scope.nextOfKinTime=false;
	$scope.photoTime=false;
	$scope.olevelTime=false;
	$scope.biodata2Time=true;
	$scope.questionTime=false;
	$scope.sitting = "- First Sitting";
	$scope.sittingNumber = 1;
	$scope.isSavedBiodata = false;
	$scope.isSavedNextOfKin= false;
	$scope.isSavedPassport= false;
	$scope.isSavedSignature= false;
	$scope.messages = "";

	
	//alert($routeParams['jambNo']);
	$scope.maritalStatus = ["[ Select Mariral Status ]", "Single","Married","Widow","Widower","Single Parent","Divorcee"];
	$scope.applicantJambNo = {"jambNumber": $routeParams['jambNo']};
	//alert(JSON.stringify($scope.applicantJambNo));
	
	
	//get applicant information
	/*$http.post("backend/sqlprocesses.php?getApplicant=yes", $scope.applicantJambNo)
		.success(function(response){
			if(response.status == "ok")
			{
				$scope.applicant = response.data;
			}
			else if(response.status == "not ok")	
			{
				$scope.message = "Unable to retrieve applicant";
				var modalInstance = $modal.open(
					{
					 templateUrl: 'partials/alerts.html',
					  controller: 'alertCtrl',
					  keyboard : false,
					  size:"sm",
					  resolve: {
								items: function () {
								  return items;
								}
					  }
					  
					});
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
			
		});*/
	
	
/*	$scope.applicant1 = {"jambNumber":$scope.jambRegNo.jambNumber,
						"gender":"[ Select Gender ]",
						 "maritalStatus":"[ Select Marital Status ]",
						 "dateOfBirth":"",
						 "nationality":"Nigerian",
						 "permanentHomeAddress":"",
						 "email":"",
						 "phoneNumber":"",
						 "deformity":"",
						 "nextOfKinName":"",
						 "nextOfKinAddress":"",
						 "nextOfKinEmail":"", 
						 "nextOfKinPhoneNumber":"",
						 "no_of_olevel_sittings":""
						};
*/
//NEW OLEVEL RESULTS PANEL
	//alert($scope.applicant.course);
	$scope.first_uploaded = false;
	$scope.upload_first = false;
	
	$scope.selectOLevelSubject = function(){
		$scope.loading_options = true;
		
		/*if(pos > 6){
			pos1 = pos - 6;
			pos2 = pos;
		}
		else{
			pos1 = pos;
			pos2 = pos + 6;
		}*/
		
		master_opts1 = angular.copy($scope.s1_options);
		master_opts2 = angular.copy($scope.s2_options);
		master_opts3 = angular.copy($scope.s3_options);
		master_opts4 = angular.copy($scope.s4_options);
		master_opts5 = angular.copy($scope.s5_options);
		master_opts6 = angular.copy($scope.s6_options);
		
		//alert(JSON.stringify(master_opts2));
		//alert($scope.firstOLevel.s4.subject);
		//alert(JSON.stringify($scope.secondOLevel));
		
		//if($scope.secondOLevel.length > 0 || $scope.number_of_sittings > 1){
			current_selections = [$scope.firstOLevel.s1.subject, $scope.firstOLevel.s2.subject, $scope.firstOLevel.s3.subject, $scope.firstOLevel.s4.subject, $scope.firstOLevel.s5.subject, $scope.firstOLevel.s6.subject, $scope.secondOLevel.s1.subject, $scope.secondOLevel.s2.subject, $scope.secondOLevel.s3.subject, $scope.secondOLevel.s4.subject, $scope.secondOLevel.s5.subject, $scope.secondOLevel.s6.subject];
		/*}
		else{
			current_selections = [$scope.firstOLevel.s1.subject, $scope.firstOLevel.s2.subject, $scope.firstOLevel.s3.subject, $scope.firstOLevel.s4.subject, $scope.firstOLevel.s5.subject, $scope.firstOLevel.s6.subject];
		}*/
		
		n_s1_options = cleanOptions(master_opts1, 1, 7, current_selections);
		n_s2_options = cleanOptions(master_opts2, 2, 8, current_selections);
		n_s3_options = cleanOptions(master_opts3, 3, 9, current_selections);
		n_s4_options = cleanOptions(master_opts4, 4, 10, current_selections);
		n_s5_options = cleanOptions(master_opts5, 5, 11, current_selections);
		n_s6_options = cleanOptions(master_opts6, 6, 12, current_selections);
		
		$scope.first_s1_options = angular.copy(n_s1_options);
		$scope.first_s2_options = angular.copy(n_s2_options);
		$scope.first_s3_options = angular.copy(n_s3_options);
		$scope.first_s4_options = angular.copy(n_s4_options);
		$scope.first_s5_options = angular.copy(n_s5_options);
		$scope.first_s6_options = angular.copy(n_s6_options);
		
		$scope.second_s1_options = angular.copy(n_s1_options);
		$scope.second_s2_options = angular.copy(n_s2_options);
		$scope.second_s3_options = angular.copy(n_s3_options);
		$scope.second_s4_options = angular.copy(n_s4_options);
		$scope.second_s5_options = angular.copy(n_s5_options);
		$scope.second_s6_options = angular.copy(n_s6_options);
		
		$timeout(function(){
			$scope.loading_options = false;
		}, 2000);
		
		//$scope.loading_options = false;
		//alert('done');
		//alert(JSON.stringify($scope.first_s3_options));
	}
	
	//alert(Date());
	
	$scope.change_scanned_upload = function(sitting){  
		if(sitting == "1"){
			$scope.upload_first = true;
			$scope.first_uploaded = false;
		}
		else{
			$scope.upload_second = true;
			$scope.second_uploaded = false;
		}
	}
	
	$scope.pickupthefile1 = function(files){  
		var fd11 = new FormData();
		fd11.append("file", files[0]);
		$scope.fd11 = fd11;
	}
	
	$scope.pickupthefile2 = function(files){  
		var fd22 = new FormData();
		fd22.append("file", files[0]);
		$scope.fd22 = fd22;
	}
	
	$scope.uploadOLevelfile = function(sitting){
		if(sitting == 1){
			$scope.upl_file = $scope.fd11;
		}
		else{
			$scope.upl_file = $scope.fd22;
		}
		
		if($scope.upl_file===undefined){
			//alert("Please choose a file first before upload");
			message_code = {status: 'error', message: 'Error. No file was chosen to be uploaded.'};
			Data.toast(message_code);
		}
		else{
			//$rootScope.content_loaded = false;
			$scope.unsaved = "";
			
			$scope.uploading_olevel = true;
			// send the file to the backend
			$http.post("backend/upload_olevel.php?upload_type=olevel&&jamb_no="+$scope.jambRegNo+"&&sitting="+sitting, $scope.upl_file, {withCredentials: true, headers: {'Content-Type': undefined },transformRequest: angular.identity })
			.success(function(data){
				//$rootScope.content_loaded = true;
				
				$scope.uploading_olevel = false;
				Data.toast(data);
				if(data.status == "success"){
					if(sitting == "1"){
						$scope.firstOLevel.examination.scanned_copy = data.file_name;
						$scope.first_olevel_scanned = "documents/"+$scope.jambRegNo+"/"+$scope.firstOLevel.examination.scanned_copy+"?"+Date();
						$scope.olevelUploadForm.first_upload = $scope.first_olevel_scanned;
						$scope.upload_first = false;
						$scope.first_uploaded = true;
					}
					else{
						$scope.secondOLevel.examination.scanned_copy = data.file_name;
						$scope.second_olevel_scanned = "documents/"+$scope.jambRegNo+"/"+$scope.secondOLevel.examination.scanned_copy+"?"+Date();
						$scope.olevelUploadForm.second_upload = $scope.second_olevel_scanned;
						$scope.upload_second = false;
						$scope.second_uploaded = true;
					}
				}
				
				$scope.unsaved = data.unsaved;
				//$scope.dataUploadIsReady = true;
				/*end of display data section*/
			})
			.error(function(errorMessage){
				//alert(errorMessage);
				
				$scope.uploading_olevel = false;
				$rootScope.content_loaded = true;
				Data.toast(data);
			});
		}
	}
	
	$http.get("backend/authentication.php?action=getCourseOLvelSubjects_PrevRes&&dep_course="+$scope.applicant.course+"&&faculty="+$scope.applicant.facultyApplyingTo+"&&jamb_no="+$scope.jambRegNo)
	.success(function(response){
		if(response.status == "success"){
			$scope.loading_options = false;
			
			$scope.s1_options = response.olevel_s1;
			$scope.s2_options = response.olevel_s2;
			$scope.s3_options = response.olevel_s3;
			$scope.s4_options = response.olevel_s4;
			$scope.s5_options = response.olevel_s5;
			$scope.s6_options = response.olevel_s6;
			
			//alert(JSON.stringify($scope.s2_options));
			
			$scope.no_of_sittings = response.no_of_sittings;
			$scope.firstOLevel = response.first_OLevel;
			$scope.secondOLevel = response.second_OLevel;
			
			if($scope.firstOLevel.examination.scanned_copy == ""){
				$scope.olevelUploadForm.first_upload = "";
				$scope.first_uploaded = false;
				$scope.upload_first = true;
			}
			else{
				$scope.first_olevel_scanned = "documents/"+$scope.jambRegNo+"/"+$scope.firstOLevel.examination.scanned_copy+"?"+Date();
				$scope.olevelUploadForm.first_upload = $scope.first_olevel_scanned;
				$scope.first_uploaded = true;
				$scope.upload_first = false;
			}
			
			if($scope.secondOLevel.examination.scanned_copy == ""){
				$scope.olevelUploadForm.second_upload = $scope.second_olevel_scanned;
				$scope.second_uploaded = false;
				$scope.upload_second = true;
			}
			else{
				$scope.second_olevel_scanned = "documents/"+$scope.jambRegNo+"/"+$scope.secondOLevel.examination.scanned_copy+"?"+Date();
				$scope.olevelUploadForm.second_upload = $scope.second_olevel_scanned;
				$scope.second_uploaded = true;
				$scope.upload_second = false;
			}
			
			$scope.first_s1_options = angular.copy($scope.s1_options);
			$scope.first_s2_options = angular.copy($scope.s2_options);
			$scope.first_s3_options = angular.copy($scope.s3_options);
			$scope.first_s4_options = angular.copy($scope.s4_options);
			$scope.first_s5_options = angular.copy($scope.s5_options);
			$scope.first_s6_options = angular.copy($scope.s6_options);
			
			//alert($scope.first_s6_options.length);
			$scope.second_s1_options = angular.copy($scope.s1_options);
			$scope.second_s2_options = angular.copy($scope.s2_options);
			$scope.second_s3_options = angular.copy($scope.s3_options);
			$scope.second_s4_options = angular.copy($scope.s4_options);
			$scope.second_s5_options = angular.copy($scope.s5_options);
			$scope.second_s6_options = angular.copy($scope.s6_options);
			
			$scope.selectOLevelSubject();
		}
		else{
			
		}
		
		//$scope.applicant.course = 'MEDICINE AND SURGERY';
		if($scope.applicant.facultyApplyingTo.toLowerCase() != 'clinical sciences' && $scope.applicant.course.toLowerCase() != 'pharmacy'){
			$scope.sittings_arr = [
									{
										'val': '1',
										'disp': '1 sitting'
									},
									{
										'val': '2',
										'disp': '2 sittings'
									}
								];
		}
		else{
			$scope.no_of_sittings = 1;
			$scope.sittings_arr = [
							{
								'val': '1',
								'disp': '1 sitting'
							}
						];
		}
		
		$rootScope.content_loaded = true;
	})
	.error(function(errorMessage){
		$rootScope.content_loaded = true;
	});
	
	$scope.olevel_pos = 0;
	
	$scope.continueOLevel = function(frm_cnt){
		//$scope.olevel_pos = pos;
		
		if($scope.olevel_pos == "1"){
			$scope.number_of_sittings = frm_cnt;
			$scope.olevel_pos++;
		}
		else if($scope.olevel_pos == "0"){
			//$scope.first_sitting_result = frm_cnt;			
			$scope.olevel_pos++;
		}
		else if($scope.olevel_pos == "2"){
			first_exam_type = $scope.firstOLevel.examination.type
			//alert(first_exam_type);
			$scope.firstres_grade_opts = getGradeOptions(first_exam_type);
			//alert(JSON.stringify($scope.firstres_grade_opts));
			$scope.olevel_pos++;
		}
		else if($scope.olevel_pos == "4"){
			second_exam_type = $scope.secondOLevel.examination.type
			//alert(second_exam_type);
			$scope.secondres_grade_opts = getGradeOptions(second_exam_type);
			//alert(JSON.stringify($scope.secondres_grade_opts));
			$scope.olevel_pos++;
		}
		else if($scope.olevel_pos == "3"){
			$scope.first_sitting_result = frm_cnt;	
			
			//alert(JSON.stringify($scope.first_sitting_result));
			
			if($scope.number_of_sittings > 1){
				$scope.olevel_pos++;
			}
			else{
				$scope.second_sitting_result = {};
				$scope.olevel_pos = 6;
				//$scope.saveOlevel($scope.number_of_sittings, $scope.first_sitting_result, $scope.second_sitting_result);
				//alert(JSON.stringify($scope.olevel_message));
			}
		}
		else if($scope.olevel_pos == "5"){
			$scope.second_sitting_result = frm_cnt;
			$scope.olevel_pos++;
		}
		else if($scope.olevel_pos == "7"){
			$scope.finalOLevelSave($scope.number_of_sittings, $scope.first_sitting_result, $scope.second_sitting_result);
		}
		else{
			/*if($scope.number_of_sittings > 1){
				$scope.second_sitting_result = {};
			}
			else{
				$scope.second_sitting_result = frm_cnt;	
			}*/
			//alert(JSON.stringify($scope.second_sitting_result));
			
			$scope.saveOlevel($scope.number_of_sittings, $scope.first_sitting_result, $scope.second_sitting_result);
			//alert(JSON.stringify($scope.olevel_message));
			//$scope.olevel_pos++;
		}
	}
	
	$scope.backOLevel = function(){
		if($scope.olevel_pos < 6){
			$scope.olevel_pos--;
		}
		else{
			if($scope.number_of_sittings == 1){
				$scope.olevel_pos = 3;
			}
			else{
				$scope.olevel_pos = 5;
			}
		}
	}
	
	$scope.saveOlevel = function(no_of_sittings, first_result, second_result){
		$scope.no_of_sittings = no_of_sittings;
		$scope.first_result = first_result;
		$scope.second_result = second_result;
		
		$scope.olevel_warning_awaiting = "";
		$scope.olevel_warning_scores = "";
		$scope.olevel_error = "";
		
		/*if(($scope.first_result.s1.subject == "" || $scope.first_result.s1.grade == "") && ($scope.second_result.s1.subject == "" || $scope.second_result.s1.grade == "")){
			$scope.olevel_error = "First SUBJECT and SCORE must be selected at least in either the first or second sitting </br>";
			alert($scope.olevel_error);
		}
		else if((($scope.first_result.s1.subject != "" && $scope.first_result.s1.grade != "") && $scope.first_result.s1.grade == "AR") || (($scope.second_result.s1.subject != "" && $scope.second_result.s1.grade != "") && $scope.second_result.s1.grade == "AR")){
			$scope.olevel_warning_awaiting = "First Subject's Score is set to awaiting result in either the first or second sitting </br>";
			alert($scope.olevel_warning_awaiting);
		}
		else if((($scope.first_result.s1.subject != "" && $scope.first_result.s1.grade != "") && convertScores($scope.first_result.s1.grade) == 0) || (($scope.second_result.s1.subject != "" && $scope.second_result.s1.grade != "") && convertScores($scope.second_result.s1.grade) == 0)){
			$scope.olevel_warning_scores = "First Subject's Score must be greater than 'C6' in either the first or second sitting </br>";
			alert($scope.olevel_warning_scores);
		}*/
		
		verification = {
						sub_error: "",
						sub_warning_awaiting: "",
						sub_warning_scores: ""
					};
		
		//alert(no_of_sittings);
		if(no_of_sittings == 1){
			verification = verifySingleResults($scope.first_result.s1.subject, $scope.first_result.s1.grade, 1, "First", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifySingleResults($scope.first_result.s2.subject, $scope.first_result.s2.grade, 2, "Second", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifySingleResults($scope.first_result.s3.subject, $scope.first_result.s3.grade, 3, "Third", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifySingleResults($scope.first_result.s4.subject, $scope.first_result.s4.grade, 4, "Fourth", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifySingleResults($scope.first_result.s5.subject, $scope.first_result.s5.grade, 5, "Fifth", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
		}
		else{
			verification = verifyDoubleResults($scope.first_result.s1.subject, $scope.first_result.s1.grade, $scope.second_result.s1.subject, $scope.second_result.s1.grade, 1, "First", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifyDoubleResults($scope.first_result.s2.subject, $scope.first_result.s2.grade, $scope.second_result.s2.subject, $scope.second_result.s2.grade, 2, "Second", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifyDoubleResults($scope.first_result.s3.subject, $scope.first_result.s3.grade, $scope.second_result.s3.subject, $scope.second_result.s3.grade, 3, "Third", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifyDoubleResults($scope.first_result.s4.subject, $scope.first_result.s4.grade, $scope.second_result.s4.subject, $scope.second_result.s4.grade, 4, "Fourth", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifyDoubleResults($scope.first_result.s5.subject, $scope.first_result.s5.grade, $scope.second_result.s5.subject, $scope.second_result.s5.grade, 5, "Fifth", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
			
			verification = verifyDoubleResults($scope.first_result.s6.subject, $scope.first_result.s6.grade, $scope.second_result.s6.subject, $scope.second_result.s6.grade, 6, "Sixth", verification.sub_error, verification.sub_warning_awaiting, verification.sub_warning_scores);
		}
		
		$scope.olevel_error = verification.sub_error;
		$scope.olevel_warning_awaiting = verification.sub_warning_awaiting;
		$scope.olevel_warning_scores = verification.sub_warning_scores+verification.sub_warning_awaiting;
		
		if($scope.no_of_sittings == 1 && $scope.olevelUploadForm.first_upload == ""){
			//Warn Applicant
			$scope.olevel_warning_scores += "No O'Level Result was Uploaded. <br/>";
		}
		
		if($scope.no_of_sittings == 2 && ($scope.olevelUploadForm.first_upload == "" || $scope.olevelUploadForm.second_upload == "")){
			//Warn Applicant
			$scope.olevel_warning_scores += "No O'Level result was uploaded either for the first or second sitting. <br/>";
		}
		
		//alert($scope.olevel_warning_scores);
		
		$scope.olevel_err_dipl = false;
		$scope.olevel_warnng_dipl = false;
		
		if($scope.olevel_error != "" || $scope.olevel_warning_awaiting != "" || $scope.olevel_warning_scores != ""){
			//alert($scope.olevel_error);
			//alert($scope.olevel_warning_awaiting);
			//alert($scope.olevel_warning_scores);
			if($scope.olevel_error != ""){
				$scope.olevel_err_dipl = true;
			}
			if($scope.olevel_warning_awaiting != "" || $scope.olevel_warning_scores != ""){
				$scope.olevel_warnng_dipl = true;
			}
			
			$scope.olevel_pos = 7;
		}
		else{
			$scope.finalOLevelSave($scope.no_of_sittings, $scope.first_result, $scope.second_result);
		}
	}
	
	$scope.finalOLevelSave = function(no_of_sittings, first_result, second_result){
		if($scope.applicant.biodataCompletionLevel < 6){
			$scope.applicant.biodataCompletionLevel = 6;
		}
		else if($scope.applicant.biodataCompletionLevel == 8){
			$scope.applicant.biodataCompletionLevel = 7;
		}
		else{
			$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
		}
		
		$http.post("backend/authentication.php?action=save_olevel&&jamb_no="+$scope.jambRegNo+"&&biodataCompletionLevel="+$scope.applicant.biodataCompletionLevel+"&&no_of_sittings="+no_of_sittings, {"first_result":first_result, "second_result":second_result})
		.success(function(response){
			//return response;
			//alert(JSON.stringify(response));
			if(response.status == "success"){
				/*if($scope.applicant.biodataCompletionLevel < 6){
					$scope.applicant.biodataCompletionLevel = 6;
				}*/
				//alert(response.computation);
				$scope.applicant.olevel_score = response.computation;
				$scope.olevel_computation = $scope.applicant.olevel_score;
				$localStorage.bio_data = $scope.applicant;
				
				$scope.openDV($scope.applicant.biodataCompletionLevel);
			}
		})
		.error(function(errorMessage){
		
		})
	}
	//CLOSE OF NEW OLEVEL PANEL
	
	$scope.acceptAttestation = function(){
		if($scope.applicant.biodataCompletionLevel < 8){
			$scope.applicant.biodataCompletionLevel = 8;
		}
		
		$http.get("backend/generate_pdf-1.php?action=attest_reg&&jamb_no="+$scope.jambRegNo+"&&biodataCompletionLevel="+$scope.applicant.biodataCompletionLevel)
		.success(function(response){
			if(response.status == "success"){
				$scope.openDV($scope.applicant.biodataCompletionLevel);
			}
		})
		.error(function(errorMessage){
		
		})
	}

// begining of navaigation buttons
/*$scope.next = function()
{
	if($scope.isSavedBiodata==false)
	{
		items = "You have not saved this page";
		modalMessage(items)
		
	}
	else
	{
	$scope.biodata2Time=false;
	$scope.nextOfKinTime=true;
	}
}*/

/*$scope.toBiodata = function()
{
	$scope.nextOfKinTime=false;
	$scope.biodata2Time=true;
}
*/
/*$scope.fromNextOfKin = function()
{
	if($scope.isSavedNextOfKin==false)
	{
		items = "You have not saved this Next of Kin page";
		modalMessage(items)
		
	}
	else
	{
	$scope.nextOfKinTime=false;
	$scope.photoTime=true;
	}
	
}*/

/*$scope.toNextOfKin = function()
{
	$scope.photoTime=false;
	$scope.nextOfKinTime=true;

}
*/

/*$scope.toOlevel = function()
{
	if($scope.isSavedPassport==false)
	{
		items = "You have not uploaded your photos";
		modalMessage(items)
		
	}
	else if($scope.isSavedSignature==false)
	{
		items = "You have not uploaded your signature";
		modalMessage(items)
	}
	else
	{
	$scope.photoTime=false;
	$scope.olevelTime=true;
	}
	
	

}

*/
/*$scope.toPhoto = function()
{
	$scope.photoTime=true;
	$scope.olevelTime=false;

}
*/


$scope.saveData = function()
{
	
if($scope.applicant1.maritalStatus == "[ Select Marital Status ]" || $scope.day1 == "[ Day ]" || $scope.month == "[ Month ]" || $scope.year1 == "[ Year ]" || $scope.applicant1.permanentHomeAddress == "" || $scope.applicant1.email == "" || $scope.applicant1.sex == "[ Select Gender ]" || $scope.applicant1.phoneNumber == "" || ($scope.anyDeformity =='Yes' && $scope.deformityType==''))
{
	$scope.confirm_error_message = "All the fields stared are compulsory, fill them and save";
}
else
{
	var theData = {
			sex 		  		: 	$scope.applicant1.sex,
			maritalStatus 		: 	$scope.applicant1.maritalStatus,
			dob 		 		: 	$scope.year1 + "-" + $scope.month + "-" + $scope.day1,
			nationality	        : 	$scope.applicant1.nationality,
			permanentHomeAddress: 	$scope.applicant1.permanentAddress,
			email	     		: 	$scope.applicant1.emailAddress,
			phoneNumber    		: 	$scope.applicant1.phoneNumber,
			anyDeformity   		: 	$scope.applicant1.anyDeformity,
			deformityType  		: 	$scope.applicant1.deformityType,
			jambRegNo			:   $scope.jambRegNo,
			deformity_device    :   $scope.applicant1.deformity_device,
			matriculated_in_ui  :   $scope.applicant1.matriculation_status,
			previous_matric_no  :   $scope.applicant1.previous_matric_no,
			biodataCompletionLevel : 3
				}
				if ($scope.applicant1.deformityType=='others') theData.deformityType = $scope.applicant1.deformityType_others;
				if ($scope.applicant1.deformity_device=='others') theData.deformity_device = $scope.applicant1.deformity_device_others;
				
			//alert(JSON.stringify(theData));	
		$http.post("backend/sqlprocesses.php?savePart2=yes", theData)
		.success(function(response1){
			if(response1.status == "ok")
			{
				/*$scope.confirm_status = true;
				$scope.confirm_success_message  = "Your information was saved successfully";*/
				message_code = {status: 'success', message: 'Your information was saved successfully.'};
				Data.toast(message_code);
				$scope.buttonParts[2] = true;
				console.log($scope.buttonParts);
				
				if($scope.applicant.biodataCompletionLevel < 3){
					$scope.applicant.biodataCompletionLevel = 3;
				}
				else if($scope.applicant.biodataCompletionLevel == 8){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else{
					$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
				}
				
				//alert($scope.applicant.biodataCompletionLevel);
				$scope.openDV($scope.applicant.biodataCompletionLevel);
				//$scope.openDV(3);

			}
			else if(response1.status == "not ok")	
			{
				/*$scope.confirm_status = false;
				$scope.confirm_error_message = "Your information was not saved successfully";*/
				message_code = {status: 'error', message: 'Error. Your information was not saved successfully.'};
				Data.toast(message_code);
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
})}

}


$scope.saveNextOfKinData = function()
{

if($scope.applicant1.nextOfKinName == "" || $scope.applicant1.nextOfKinAddress == "" || $scope.applicant1.nextOfKinEmail == "" || $scope.applicant1.nextOfKinPhoneNumber == "")
{
	items = "All the fields starred are compulsory, fill them and save";
	modalMessage(items);
	
}
else
{
		var theData = {
			nextOfKinName  		: 	$scope.applicant1.nextOfKin,
			nextOfKinAddress	: 	$scope.applicant1.nextOfKinAddress,
			nextOfKinEmail 		: 	$scope.applicant1.nextOfKinEmail,
			nextOfKinPhoneNumber: 	$scope.applicant1.nextOfKinPhoneNumber,
			jambRegNo			:   $scope.jambRegNo,
			biodataCompletionLevel : 6
				}
		//alert(JSON.stringify(theData));
		$http.post("backend/sqlprocesses.php?saveNextOfKin=yes", theData)
		.success(function(response1){
			if(response1.status == "ok")
			{
				/*$scope.isSavedNextOfKin= true;
				flashMessage("Your information was saved successfully");*/
				/*$scope.confirm_status = true;
				$scope.confirm_success_message  = "Your information was saved successfully";*/
				message_code = {status: 'success', message: 'Your information was saved successfully.'};
				Data.toast(message_code);
				
				$scope.buttonParts[3] = true;
				console.log($scope.buttonParts);
				
				if($scope.applicant.biodataCompletionLevel < 6){
					$scope.applicant.biodataCompletionLevel = 6;
				}
				else if($scope.applicant.biodataCompletionLevel == 8){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else{
					$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
				}
				
				//alert($scope.applicant.biodataCompletionLevel);
				$scope.openDV($scope.applicant.biodataCompletionLevel);
				//$scope.openDV(4);

				
			}
			else if(response1.status == "not ok")	
			{
//				flashMessage("Your information was not saved successfully");
				/*$scope.confirm_status = false;
				$scope.confirm_error_message = "Your information was not saved successfully";*/
				
				message_code = {status: 'error', message: 'Error. Your information was not saved successfully.'};
				Data.toast(message_code);
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
})}
}


/*$scope.saveOlevelSubjects = function()
{
	if($scope.examination.year == "[ Select Examination Year ]" || $scope.examination.type == "[ Select Examination Type ]" || $scope.examination.month == "[ Select Examination Month ]" || $scope.examination.center == "" || $scope.examination.number == "")
{
	items = "All the fields stared are compulsory, fill them and save";
	modalMessage(items);
	
}
else
{
		sentItems = {"subjectsAndGrades":$scope.subjectAndGrade, "examData": $scope.examination};
		$http.post("backend/sqlprocesses.php?saveSubjects=yes", sentItems)
		.success(function(response1)
		{
			if(response1.status == "ok")
			{
				
				   items = "Your information was saved successfully";
				   modalMessage(items)
				/// work on this part
	
					if($scope.sitting == "- Second Sitting")
					{
						items = "You have successfully completed the forms";
						modalMessage(items)
					}
					else
					{
						$scope.questionTime= true;
						$scope.olevelTime=false;
					}
			}
			else if(response1.status == "not ok")	
			{
				items = "Your information was not saved successfully";
				modalMessage(items);
			}
			else
			{
				items = "System Error, Please check your entries";
				modalMessage(items)
			}
		}) //end of success' call back
		.error(function(errorMessage){
			flashMessage();
			items = "System Error, Please check your entries";
			modalMessage(items)
		}) // end of error call back
}
};
*/
// save operations ends here

// end of navigation buttons	
/*$scope.yes = function()
{

	$scope.sitting = "- Second Sitting";
	$scope.sittingNumber = 2;
	$scope.subjectCounter = 0;
	$scope.subjectAndGrade =[];
	$scope.olevelSubjects = [];
	$scope.examination = {"jambNumber": $scope.applicantJambNo.jambNumber,
						  "sitting": $scope.sittingNumber,
						  "year":"[ Select Examination Year ]",
						  "type":"[ Select Examination Type ]",
						  "month":"[ Select Examination Month ]",
						  "center":"",
						  "number":""};	
	$scope.olevelSubjects = angular.copy($scope.olevelSubjectsCopy);
	$scope.questionTime= false;
	$scope.olevelTime=true;

}
*/
/*$scope.no = function()
{
$scope.olevelTime=false;
$scope.questionTime= false;

items = "You have successfully completed this session";
modalMessage(items);
}
*/

// response to questions


// end of response to questions

/* beginning of date stuff */
/* $scope.clear = function () {
    $scope.applicanat1.dateOfBirth = null;
  };
  
  $scope.toggleMin = function() {
    $scope.minDate = $scope.minDate ? null : new Date();
  };
  $scope.toggleMin();

  $scope.open = function($event) {
    $event.preventDefault();
    $event.stopPropagation();

    $scope.opened = true;
  };

  $scope.dateOptions = {
    formatYear: 'yyyy',
    startingDay: 1
  };

  $scope.formats = ['dd-MMMM-yyyy', 'yyyy/MM/dd', 'dd.MM.yyyy', 'shortDate', 'yyyy-MM-dd' ];
  $scope.format = $scope.formats[4];
*/

/*
end of date stuff
*/

	// addition of subject handler
/*	$scope.addSelected = function()
	{
	   if($scope.subjectCounter >= 9)
	   {
		items = "You cannot pick more than 9 subjects";
	   	modalMessage(items);
	   }
	   else
	   {
		if($scope.subject=="[ Select Subjects ]")
			{
				$scope.message ="Pick a Subject";
				items = $scope.message;
				modalMessage(items);
			}
			else if($scope.grade=="[ Select Grades ]")
			{
				items = "Pick a Grade for the subject";
				modalMessage(items);
			}else
			{
				$scope.subjectAndGrade.push({"subj":$scope.subject, "grade":$scope.grade});
				indexofElement = indexOfAnElement($scope.olevelSubjects, $scope.subject)
				$scope.subjectCounter += 1;
				if($scope.subjectCounter > 1) $scope.singleOrMore = "subjects";
				$scope.olevelSubjects.splice(indexofElement,1)
				$scope.subject = "[ Select Subjects ]"
				$scope.grade = "[ Select Grades ]"
				$scope.olevelSelected = false;
				
				}
		
		}
	}
*/		
/*	$scope.changedSubject = function()
	{
		if($scope.subject!= "[ Select Subjects ]")	$scope.olevelSelected = true;
			
		
	}
*/	
	// months in the year
	$scope.months2 = ["January","February","March","April","May","June","July","August","September","October","November","December"];
	$scope.years = [];
	today = new Date();
	thisYear = today.getFullYear();
	
	for (i=1980; i<= thisYear; i++){
		$scope.years.push(i);
	}
	
	
	$scope.examination = {"jambNumber": $scope.applicantJambNo.jambNumber,
							"sitting":$scope.sittingNumber,
							"year":"[ Select Examination Year ]",
							"type":"[ Select Examination Type ]",
							"month":"[ Select Examination Month ]",
							"center":"",
							"number":""};	

	$scope.examinationType = ["CAMBRIDGE GCE", "GCE", "IGCSE", "NECO", "WAEC"];
	
/*	$scope.deleteSubject = function(theIndex)
	{
		$scope.olevelSubjects.push({"courseCode":$scope.subjectAndGrade[theIndex].subj,"courseTitle":$scope.subjectAndGrade[theIndex].subj})
		$scope.olevelSubjects.sort();
		$scope.subjectAndGrade.splice(theIndex,1)
		$scope.subjectCounter -= 1;
		if($scope.subjectCounter < 2) $scope.singleOrMore = "subject";

		
	}
*/	
	$scope.grades = ["Awaiting Result","A1", "B2", "B3", "C4", "C5", "C6", "P7", "P8", "F9"];
	$scope.applicantPhoto = $scope.jambRegNo + ".jpg";
	$scope.applicantSignature = $scope.jambRegNo + ".jpg";
	
	// show profile picture upload
	$scope.uploadProfilePicture = function()
	{
		$scope.uploadProfileImaage = true;
	}
	/*$scope.applicant1.nationality = "[ Select Nationality ]";
	$scope.applicant1.deformity = "[ Select Option ]";
	$scope.nationality = ["[ Select Nationality ]"];*/
	//get nationality
	$http.post("backend/sqlprocesses.php?getNationality=yes")
		.success(function(response){
			if(response.status == "ok")
			{
				//alert(JSON.stringify(response.data));
				//$scope.nationality = [];
				
				lengthOfNation = response.data.length;
				for(i=0; i<= lengthOfNation-1; i++)
				{
					$scope.nationality.push(response.data[i].country);
				}
				$scope.applicant1.nationality = $scope.applicant.nationality ;
			}
			else if(response.status == "not ok")	
			{
				items = "Unable to retrieve nationality";
				modalMessage(items);
				
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
			
		})
		
		$scope.affiliates = ["[ Select Affiliate Institution ]"];
	$http.post("backend/sqlprocesses.php?getAffiliate=yes")
		.success(function(response){
			if(response.status == "ok")
			{
				//alert(JSON.stringify(response.data));
				//$scope.nationality = [];
				
				lengthOfData = response.data.length;
				for(i=0; i<= lengthOfData-1; i++)
				{
					$scope.affiliates.push(response.data[i].institution);
				}
				//update7();
				if($scope.applicant.biodataCompletionLevel >= 7)
					{
						$scope.applicant1.affiliate_institution = $scope.applicant.affiliate_institution ;
						$scope.programmeIsready= true;
						$scope.applicant1.affiliate_programme = $scope.applicant.affiliate_institution_programme ;
						$scope.affiliate_programme.push($scope.applicant1.affiliate_programme)
						//alert($scope.applicant1.affiliate_programme);

					}
			}
			else if(response.status == "not ok")	
			{
				items = "Unable to retrieve nationality";
				modalMessage(items);
				
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
			
		})
		



/////////////////////////////////////////////////////////////////////submission of affiliated institution's data /////////////////////////////////////////////////////
$scope.saveAffiliated = function()
{
	theData = {
		'institution': $scope.applicant1.affiliate_institution,
		'programme':$scope.applicant1.affiliate_programme,
		'biodataCompletionLevel': 7,
		'jambRegNo':$scope.applicant.jambRegNo
		};
		
		$http.post("backend/sqlprocesses.php?saveAffiliated=yes", theData)
		.success(function(response1){
			if(response1.status == "ok")
			{
				/*$scope.confirm_status = true;
				$scope.confirm_success_message  = "Your information was saved successfully";*/
				
				message_code = {status: 'success', message: 'Your information was saved successfully.'};
				Data.toast(message_code);
				
				$scope.buttonParts[6] = true;
				console.log($scope.buttonParts);
				
				if($scope.applicant.biodataCompletionLevel < 7){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else if($scope.applicant.biodataCompletionLevel == 8){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else{
					$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
				}
				
				//alert($scope.applicant.biodataCompletionLevel);
				$scope.openDV($scope.applicant.biodataCompletionLevel);
				//$scope.openDV(7);


			}
			else if(response1.status == "not ok")	
			{
				/*$scope.confirm_status = false;
				$scope.confirm_error_message = "Your information was not saved successfully";*/
				
				message_code = {status: 'error', message: 'Error. Your information was not saved successfully.'};
				Data.toast(message_code);
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
})
	
}
///////////////////////////////////////////////////////////////////// end of submission of affiliated institution's data /////////////////////////////////////////////  		


/////////////////////////////////////////////////////////////////////skip affiliated institution's data /////////////////////////////////////////////////////
$scope.skip_affiliated = function()
{
	theData = {
		'biodataCompletionLevel': 7,
		'jambRegNo':$scope.applicant.jambRegNo
		};
				$http.post("backend/sqlprocesses.php?skipAffiliated=yes", theData)
		.success(function(response1){
			if(response1.status == "ok")
			{
				/*$scope.confirm_status = true;
				$scope.confirm_success_message  = "This section is skipped";*/
				
				
				message_code = {status: 'success', message: 'This section is skipped.'};
				Data.toast(message_code);
				
				$scope.buttonParts[6] = true;
				console.log($scope.buttonParts);
				
				if($scope.applicant.biodataCompletionLevel < 7){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else if($scope.applicant.biodataCompletionLevel == 8){
					$scope.applicant.biodataCompletionLevel = 7;
				}
				else{
					$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
				}
				
				//alert($scope.applicant.biodataCompletionLevel);
				$scope.openDV($scope.applicant.biodataCompletionLevel);
				//$scope.openDV(7);


			}
			else if(response1.status == "not ok")	
			{
				/*$scope.confirm_status = false;
				$scope.confirm_error_message = "Your information was not saved successfully";*/
				
				
				message_code = {status: 'error', message: 'Error. Your information was not saved successfully.'};
				Data.toast(message_code);
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
})

	
}
///////////////////////////////////////////////////////////////////// end of skip affiliated institution's data /////////////////////////////////////////////  		
		
$scope.programmeIsready= false;
$scope.affiliate_programme = ["[ Select Programme ]"];

$scope.getProgramme = function(institution)
{
	$scope.programmeIsready= false;

	if(institution=="[ Select Affiliate Institution ]")
	{
	}else
	{
		$scope.affiliate_programme = ["[ Select Programme ]"];
		theData = {'institution': institution};
		$http.post("backend/sqlprocesses.php?getProgramme=yes", theData)
		.success(function(response){
			if(response.status == "ok")
			{
				//alert(JSON.stringify(response.data));
				//$scope.nationality = [];
				$scope.programmeIsready = true;
				lengthOfData = response.data.length;
				for(i=0; i<= lengthOfData-1; i++)
				{
					$scope.affiliate_programme.push(response.data[i]);
				}
			}
			else if(response.status == "not ok")	
			{
				//items = "Unable to retrieve nationality";
				//modalMessage(items);
				
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
			
		})
	}
}

		
		/*$http.post("backend/sqlprocesses.php?getOlevel=yes")
		.success(function(response1){
			if(response1.status == "ok")
			{
				$scope.olevelSubjects = response1.data;
				$scope.olevelSubjectsCopy = angular.copy($scope.olevelSubjects);
			}
			else if(response1.status == "not ok")	
			{
				var modalInstance = $modal.open(
					{
					  templateUrl: 'partials/login.html',
					  controller: 'validationCtrl',
					  keyboard : false
					  
					});
			}
			else
			{
			
			}
		})
		.error(function(errorMessage){
			
		})*/
		
		
	
// implementation of profile picture
$scope.uploadProfilePicture1 = function(files) {
				var fd1 = new FormData();
				//alert($scope.theIndex);
				console.log(fd1);
					//Take the first selected file
					fd1.append("file", files[0]);
					var profilePictureFilename = $scope.jambRegNo;
					fd1.append("name", profilePictureFilename);
					$scope.fd1 = fd1;
					$scope.isSelected = true;

		
				};
	
$scope.uploadProfilePictureExt = function() {
			if( $scope.fd1===undefined)
			{
				items ="File has not been selected";
				modalMessage(items)
			}
			else
			{

			
    		$http.post("backend/profilepicture.php?what=passport", $scope.fd1, {withCredentials: true, headers: {'Content-Type': undefined },transformRequest: angular.identity })
			.success(function(data){
				if(data.status == "ok")
					{
						$scope.applicantPhoto = $scope.jambRegNo + ".jpg" + '?' + new Date().getTime();
						//alert($scope.applicantPhoto)
						$scope.uploadProfileImaage = false;
						$scope.isSavedPassport=true;
						if($scope.isSavedPassport==true && $scope.isSavedSignature==true)
						{
							//$scope.openDV(5);
							theData = { jambRegNo				:   $scope.jambRegNo,
										biodataCompletionLevel  : 5
										};
							$http.post("backend/sqlprocesses.php?photoAndSignature=yes", theData)
								.success(function(response1){
									if(response1.status == "ok")
									{
										/*$scope.confirm_status = true;
										$scope.confirm_success_message  = data.message;*/
										
										message_code = {status: 'success', message: data.message};
										Data.toast(message_code);
										
										$scope.buttonParts[4] = true;
										
										if($scope.applicant.biodataCompletionLevel < 5){
											$scope.applicant.biodataCompletionLevel = 5;
										}
										else if($scope.applicant.biodataCompletionLevel == 8){
											$scope.applicant.biodataCompletionLevel = 7;
										}
										else{
											$scope.applicant.biodataCompletionLevel = $scope.applicant.biodataCompletionLevel;
										}
										
										//alert($scope.applicant.biodataCompletionLevel);
										$scope.openDV($scope.applicant.biodataCompletionLevel);
										//$scope.openDV(5);

										
									}
									else if(response1.status == "not ok")	
									{
						//				flashMessage("Your information was not saved successfully");
										/*$scope.confirm_status = false;
										$scope.confirm_error_message = "Your information was not saved successfully";*/
										
										message_code = {status: 'error', message: 'Error. Your information was not saved successfully.'};
										Data.toast(message_code);
									}
									else
									{
									
									}
								})
								.error(function(errorMessage){
						})
				}
				items ="Passport has been uploaded successfully";
				modalMessage(items)
					} else if (data.status == "not ok")
					{
						items =data.message;
						modalMessage(items)
						
					}
					

				})
			.error(function(errMes){
				items ="Passport was not uploaded successfully" + "There was " + errMes + " error" ;
				modalMessage(items);
				
				});
			}
		};		
// end of implementation of profile picture

$scope.cancelProfileFileUpload = function()
		{
			$scope.uploadProfileImaage = false;
			}
	
	


//$scope.photoAndPassportAreUploaded = ($scope.isSavedPassport && $scope.isSavedSignature);	
// implementation of signature upload
$scope.uploadSignatureHandler1 = function(files) {
				var fd2 = new FormData();
					fd2.append("file", files[0]);
					var signatureFilename = $scope.jambRegNo;
					fd2.append("name", signatureFilename);
					$scope.fd2 = fd2;
					$scope.isSelected = true;
				};
		
$scope.uploadSignatureHandler = function() {
	  if( $scope.fd2===undefined)
	  {
		  items ="File has not been selected";
		  modalMessage(items)
	  }
	  else
	  {
    	$http.post("backend/profilepicture.php?what=signature", $scope.fd2, {withCredentials: true, headers: {'Content-Type': undefined },transformRequest: angular.identity })
			.success(function(data){
				if(data.status == "ok")
					{
							// put whatever you want here
							$scope.applicantSignature = $scope.jambRegNo + ".jpg" + '?' + new Date().getTime();
							$scope.uploadSignature = false;
							$scope.isSavedSignature=true;
							if($scope.isSavedPassport==true && $scope.isSavedSignature==true)
							{
								$scope.buttonParts[4] = true;
								theData = { jambRegNo				:   $scope.jambRegNo,
											biodataCompletionLevel  : 5
											};
								$http.post("backend/sqlprocesses.php?photoAndSignature=yes", theData)
											.success(function(response1){
												if(response1.status == "ok")
												{
													/*$scope.confirm_status = true;
													$scope.confirm_success_message  = "Your information was saved successfully";*/
													
													message_code = {status: 'success', message: 'Your information was saved successfully.'};
													Data.toast(message_code);
													
													$scope.buttonParts[4] = true;
													$scope.openDV(5);
												}
												else if(response1.status == "not ok")	
												{
									//				flashMessage("Your information was not saved successfully");
													/*$scope.confirm_status = false;
													$scope.confirm_error_message = "Your information was not saved successfully";*/
													
													message_code = {status: 'error', message: 'Error. Your information not was saved successfully.'};
													Data.toast(message_code);
												}
												else
												{
												
												}
											})
											.error(function(errorMessage){
									})
							}
							items ="Signature has been uploaded successfully";
							//$scope.buttonParts[4] = true;
							console.log($scope.buttonParts);
							modalMessage(items)
					}else if (data.status == "not ok")
					{
						items =data.message;
						modalMessage(items)
						
					}
				})
			.error(function(errMes){
				items ="Signature was not uploaded successfully" + "There was " + errMes + " error" ;
				modalMessage(items);
				
				});
			}
		};
		
		
// end of implementation of signature upload
	
// show signature buttons for upload
	$scope.showSignButton = function()
		{
			$scope.uploadSignature = true;
		}


function modalMessage(items)
{
	
		  var modalInstance = $modal.open(
		  {
			templateUrl: 'partials/alertok.html',
			controller: 'alertCtrl',
			keyboard : false,
			size:"sm",
			resolve: {
					  items: function () {
						return items;
					  }
			}
			
		  });
	
	}	
function indexOfAnElement(theArray, searchElement)
{

	n = theArray.length;
	for(i=0; i<=n-1; i++)
	{
		theElement = theArray[i];
		if(theElement.courseTitle===searchElement)
		{
			return i;
		}
	}
	
	}
	
function flashMessage(mess)
{
	$scope.messages = mess;
	  $timeout(function(){
	  $scope.messages = "";
	  },2000);
}

// this  is function is used to split dates for the view date components
	function dateSplitter(theDate)
	{
			dateComponents = theDate.split("-");
			return dateComponents;
	}
	


function update2()
{
	$scope.applicant1 =
	{
		
		// part2
		'sex': "[ Select Gender ]",
		'maritalStatus': "[ Select Mariral Status ]",
		'dateOfBirth': "",
		'nationality': "Nigeria",
		'permanentAddress': "",
		'emailAddress': "",
		'phoneNumber': "",
		'anyDeformity': "[ Select Option ]",
		'deformityType': "",
		// part3
		
		'nextOfKin':"",
		'addressOfNextOfKin':"",
		'phoneNumberOfNextOfKin':"",
		'emailOfNextOfKin':"",
		
		// part4
		
		// part5
		
		// part6
		'affiliate_institution':"[ Select Affiliate Institution ]",
		'affiliate_programme':"[ Select Programme ]"
	};
	
}
function update3()
{
	 var holder = dateSplitter($scope.applicant.dateOfBirth);
	  $scope.year1 = holder[0];
	  $scope.month = holder[1];
	  $scope.day1 = holder[2];
	$scope.applicant1 =
	{
		
		// part2
		'sex': $scope.applicant.sex,
		'maritalStatus':  $scope.applicant.maritalStatus,
		'nationality':$scope.applicant.nationality,
		'permanentAddress': $scope.applicant.permanentAddress,
		'emailAddress': $scope.applicant.emailAddress,
		'phoneNumber': $scope.applicant.phoneNumber,
		'anyDeformity': $scope.applicant.anydeformity,
		'deformityType': $scope.applicant.typeOfDeformity,
		// part3
		
		
		'nextOfKin':"",
		'addressOfNextOfKin':"",
		'phoneNumberOfNextOfKin':"",
		'emailOfNextOfKin':"",
		
		// part4
		
		// part5
		
		// part6
		'affiliate_institution':"[ Select Affiliate Institution ]",
		'affiliate_programme':"[ Select Programme ]"
	};
	
}
function update4()
{
	var holder = dateSplitter($scope.applicant.dateOfBirth);
	  $scope.year1 = holder[0];
	  $scope.month = holder[1];
	  $scope.day1 = holder[2];

	$scope.applicant1 =
	{
		
		// part2
		'sex': $scope.applicant.sex,
		'maritalStatus':  $scope.applicant.maritalStatus,
		'nationality':$scope.applicant.nationality,
		'permanentAddress': $scope.applicant.permanentAddress,
		'emailAddress': $scope.applicant.emailAddress,
		'phoneNumber': $scope.applicant.phoneNumber,
		'anyDeformity': $scope.applicant.anydeformity,
		'deformityType': $scope.applicant.typeOfDeformity,
		// part3
		
		'nextOfKin':$scope.applicant.nextOfKin,
		'addressOfNextOfKin':$scope.applicant.addressOfNextOfKin,
		'phoneNumberOfNextOfKin':$scope.applicant.phoneNumberOfNextOfKin,
		'emailOfNextOfKin':$scope.applicant.emailOfNextOfKin,
		
		// part4
		
		// part5
		
		// part6
		'affiliate_institution':"[ Select Affiliate Institution ]",
		'affiliate_programme':"[ Select Programme ]"
	};
	
}


function update5()
{
	 var holder = dateSplitter($scope.applicant.dateOfBirth);
	  $scope.year1 = holder[0];
	  $scope.month = holder[1];
	  $scope.day1 = holder[2];
	 // $scope.nationality = [$scope.applicant.nationality];
	$scope.applicant1 =
	{
		
		// part2
		'sex': $scope.applicant.sex,
		'maritalStatus':  $scope.applicant.maritalStatus,
		//'nationality': $scope.applicant.nationality,
		'permanentAddress': $scope.applicant.permanentAddress,
		'emailAddress': $scope.applicant.emailAddress,
		'phoneNumber': $scope.applicant.phoneNumber,
		'anyDeformity': $scope.applicant.anydeformity,
		'deformityType': $scope.applicant.typeOfDeformity,
		// part3
		
		'nextOfKin':$scope.applicant.nextOfKin,
		'nextOfKinAddress':$scope.applicant.addressOfNextOfKin,
		'nextOfKinPhoneNumber':$scope.applicant.phoneNumberOfNextOfKin,
		'nextOfKinEmail':$scope.applicant.emailOfNextOfKin,
		
		// part4
		
		// part5
		
		// part6
		'affiliate_institution':"[ Select Affiliate Institution ]",
		'affiliate_programme':"[ Select Programme ]"
	};

}

function update6()
{
	 var holder = dateSplitter($scope.applicant.dateOfBirth);
	  $scope.year1 = holder[0];
	  $scope.month = holder[1];
	  $scope.day1 = holder[2];
	$scope.applicant1 =
	{
		
		// part2
		'sex': $scope.applicant.sex,
		'maritalStatus':  $scope.applicant.maritalStatus,
		//'nationality': $scope.applicant.nationality,
		'permanentAddress': $scope.applicant.permanentAddress,
		'emailAddress': $scope.applicant.emailAddress,
		'phoneNumber': $scope.applicant.phoneNumber,
		'anyDeformity': $scope.applicant.anydeformity,
		'deformityType': $scope.applicant.typeOfDeformity,
		// part3
		
		'nextOfKin':$scope.applicant.nextOfKin,
		'nextOfKinAddress':$scope.applicant.addressOfNextOfKin,
		'nextOfKinPhoneNumber':$scope.applicant.phoneNumberOfNextOfKin,
		'nextOfKinEmail':$scope.applicant.emailOfNextOfKin,
		
		// part4
		
		// part5
		
		// part6 
		'affiliate_institution':"[ Select Affiliate Institution ]",
		'affiliate_programme':"[ Select Programme ]"
		
	};
}
	
function update7()
{
	 var holder = dateSplitter($scope.applicant.dateOfBirth);
	  $scope.year1 = holder[0];
	  $scope.month = holder[1];
	  $scope.day1 = holder[2];
	$scope.applicant1 =
	{
		
		// part2
		'sex': $scope.applicant.sex,
		'maritalStatus':  $scope.applicant.maritalStatus,
		//'nationality': $scope.applicant.nationality,
		'permanentAddress': $scope.applicant.permanentAddress,
		'emailAddress': $scope.applicant.emailAddress,
		'phoneNumber': $scope.applicant.phoneNumber,
		'anyDeformity': $scope.applicant.anydeformity,
		'deformityType': $scope.applicant.typeOfDeformity,
		// part3
		
		'nextOfKin':$scope.applicant.nextOfKin,
		'nextOfKinAddress':$scope.applicant.addressOfNextOfKin,
		'nextOfKinPhoneNumber':$scope.applicant.phoneNumberOfNextOfKin,
		'nextOfKinEmail':$scope.applicant.emailOfNextOfKin
		
		// part4
		
		// part5
		
		// part6 
		//'affiliate_institution':$scope.applicant.affiliate_institution,
		//'affiliate_programme':$scope.applicant.affiliate_programme
		
	};
	
		
	
	
}

	for(i=1; i<$scope.applicant1.biodataCompletionLevel; i++)
	  {
		  $scope.buttonParts[i]= true;
	  }
	console.log($scope.buttonParts);
  
	if($scope.applicant1.biodataCompletionLevel==1)
	{
		update2();
		//alert();
	}
	else if($scope.applicant1.biodataCompletionLevel==2)
	{
		update2();
		//alert();
	}else if($scope.applicant1.biodataCompletionLevel==3)
	{
		update3();
		console.log("level three");	
		console.log($scope.applicant1);
	}else if($scope.applicant1.biodataCompletionLevel==4)
	{
		update4();	
		console.log("level four");	
		console.log($scope.applicant1);
	}else if($scope.applicant1.biodataCompletionLevel==5)
	{
		update5();
		console.log("level five");	
		console.log($scope.applicant1);	
	}else if($scope.applicant1.biodataCompletionLevel==6)
	{
		update6();	
	}
	else if($scope.applicant1.biodataCompletionLevel==7)
	{
		update7();	
	}
	else
	{
		update7();	
	}
});

function convertScores(grade){
	score = 0;
	
	if(grade == "A1" || grade == "A*"){
		score = 6;
	}
	else if(grade == "B2" || grade == "A"){
		score = 5;
	}
	else if(grade == "B3" || grade == "B"){
		score = 4;
	}
	else if(grade == "C4" || grade == "C"){
		score = 3;
	}
	else if(grade == "C5" || grade == "D"){
		score = 2;
	}
	else if(grade == "C6" || grade == "E"){
		score = 1;
	}
	else{
		score = 0;
	}
	
	return score
}

function verifySingleResults(fs_subject, fs_grade, sub_pos, sub_pos_desc, sub_error, sub_warning_awaiting, sub_warning_scores){
	if(fs_subject == "" || fs_grade == ""){
		sub_error += sub_pos_desc+" SUBJECT and SCORE must be selected. <br/>";
	}
	else if((fs_subject != "" && fs_grade != "") && fs_grade == "AR"){
		sub_warning_awaiting += sub_pos_desc+" Subject's Score is set to awaiting result. <br/>";
	}
	else if((fs_subject != "" && fs_grade != "") && convertScores(fs_grade) == 0){
		sub_warning_scores += sub_pos_desc+" Subject's Score must be at least 'C6' <br/>";
	}
	
	verification = {
						sub_error: sub_error,
						sub_warning_awaiting: sub_warning_awaiting,
						sub_warning_scores: sub_warning_scores
					};
	
	return verification;
}

function verifyDoubleResults(fs_subject, fs_grade, ss_subject, ss_grade, sub_pos, sub_pos_desc, sub_error, sub_warning_awaiting, sub_warning_scores){
	if((fs_subject == "" || fs_grade == "") && (ss_subject == "" || ss_grade == "")){
		sub_error += sub_pos_desc+" SUBJECT and SCORE must be selected at least in either the first or second sitting <br/>";
	}
	else if(((fs_subject != "" && fs_grade != "") && fs_grade == "AR") || ((ss_subject != "" && ss_grade != "") && ss_grade == "AR")){
		sub_warning_awaiting += sub_pos_desc+" Subject's Score is set to awaiting result in either the first or second sitting <br/>";
	}
	else {
		if(((fs_subject != "" && fs_grade != "") && convertScores(fs_grade) > 0) || ((ss_subject != "" && ss_grade != "") && convertScores(ss_grade) > 0)){
			//do noting
		}
		else{
			sub_warning_scores += sub_pos_desc+" Subject's Score must be at least 'C6' in either the first or second sitting <br/>";
		}
	}
	
	verification = {
						sub_error: sub_error,
						sub_warning_awaiting: sub_warning_awaiting,
						sub_warning_scores: sub_warning_scores
					};
	
	return verification;
}

function cleanOptions(master_opts, pos1, pos2, current_selections){
	//alert(master_opts.length);
	
	for(i = 0; i < current_selections.length; i++){
		k = i + 1;
		if(k == pos1 || k == pos2){
			//alert(current_selections[i]);
		}
		else{
			for(j = 0; j < master_opts.length; j++){
				if(master_opts[j] == current_selections[i]){
					master_opts.splice(j, 1);
				}
			}
		}
	}
	
	/*for(j = 0; j < master_opts.length; j++){
		option = master_opts[j];
		
		for(i = 0; i < current_selections.length; i++){
			k = i + 1;
			if(k == pos1 || k == pos2){
				
			}
			else{
				if(option == current_selections[i]){
					master_opts.splice(j, 1);
					//alert(option);
					//break;
				}
			}
		}
	}*/
	//alert(JSON.stringify(master_opts));
	return master_opts;
}

function getGradeOptions(exam_type){
	if(exam_type == "CAMBRIDGE GCE"){
		grade_options = [
							{'val': 'A', 'disp': 'A'},
							{'val': 'B', 'disp': 'B'},
							{'val': 'C', 'disp': 'C'},
							{'val': 'D', 'disp': 'D'},
							{'val': 'E', 'disp': 'E'},
							{'val': 'AR', 'disp': 'AWAITING RESULT'}
						];
	}
	else if(exam_type == "IGCSE"){
		grade_options = [
							{'val': 'A*', 'disp': 'A*'},
							{'val': 'A', 'disp': 'A'},
							{'val': 'B', 'disp': 'B'},
							{'val': 'C', 'disp': 'C'},
							{'val': 'D', 'disp': 'D'},
							{'val': 'E', 'disp': 'E'},
							{'val': 'AR', 'disp': 'AWAITING RESULT'}
						];		
	}
	else{
		grade_options = [
							{'val': 'A1', 'disp': 'A1'},
							{'val': 'B2', 'disp': 'B2'},
							{'val': 'B3', 'disp': 'B3'},
							{'val': 'C4', 'disp': 'C4'},
							{'val': 'C5', 'disp': 'C5'},
							{'val': 'C6', 'disp': 'C6'},
							{'val': 'D7', 'disp': 'D7'},
							{'val': 'E8', 'disp': 'E8'},
							{'val': 'F9', 'disp': 'F9'},
							{'val': 'AR', 'disp': 'AWAITING RESULT'}
						];
		
	}
	
	return grade_options;
}

